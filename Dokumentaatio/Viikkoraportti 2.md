Viikkoraportti 2
=======

Toisella viikolla tavoitteena oli aloittaa varsinaisen 15-pelin ratkaisu algoritmin koodaaminen. Kävin torstaina kysymässä
muutamia vinkkejä käytännön toteutuksesta. Näistä suurin osa oli sellaisia asioita joita olin jo pohtinut valmiiksi, mutta
halusin niille vielä varmistuksen. Perehdyin ratkaisualgoritmiin torstai-iltai illasta eteenpäin ja sainkin varsin nopeasti
koodattua tehokkaan ratkaisu algoritmin 3x3 -matriisin eli 8-pelin ratkaisemiseen.  Illan päätteeksi kokeilin toimisiko kyseinen algoritmi jo sellaisenaan 4x4 -matriisiin, muttei toiminut. 

Itse algoritmin toiminta on hyvin yksinkertainen: konstruoidaan alkutilanne, josta algoritmi lähtee rakentamaan seuraavia pelitilanteita ja tallentaa niitä kekoon, josta nostetaan seuraavaksi tarkasteltavaksi pelitilanteeksi aina sillä hetkellä optimaallisin. Ongelmaksi muodostui toimivan heuristiikka funktion löytäminen, eli funktion jonka tehtävänä on arvottaa eri pelitilanteet niiden sopivuuden mukaan. Lähdin liikkeelle perinteisellä Manhattan distancella, MD, jossa pelin arvo määritellään sen mukaan kuinka monen "askeleen" päässä kukin pelilaatta on oikeasta paikastaan. Tällä tavoin sain 3x3 matriisit ratkeamaan varsin nopeasti, mutta joidenkin pelitilanteiden kohdalla algoritmi näytti jäävän luuppiin saavutettuaan jonkin MD-arvon. Tämä johtuu todennäköisesti siitä, että pelin konstruoimat uudet pelitilanteet ovat arvoltaan (MD) lähes yhtä arvokkaita kuin edelliset, jonka takia keosta nostetaan uudelleen ja uudelleen lähes identtisiä pelitilanteita.

Algoritmin toimimattomuus 15-pelin kohdalla jäi vaivaamaan todenteolla ja jatkoin perjantaina asiaan paneutumista. Päättelin ja havaitsin käytännön kokeilujen perusteella, että ikävät laskennalliset luupit voi välttää, kun manhattan distancea painottaa tehtyjen siirtojen määrällä. Siis value = MD + siirtojen lukumäärä, jolla pelitilanteeseen on päästy. Tällöin siirtojen lukumäärä alkaa hyvinkin nopeasti dominoimaan value-arvoa ja algoritmi "havaitsee" nopeasti, ettei pelitilanne ole suotuisa. Tällä hyvinkin yksinkertaisella painotuksella sain laskettua laskenta aikaa 3x3 matriisin tapauksessa yli puolella ja saavutin lähestulkoon optimaallisimpia mahdollisia tuloksia. Nopean aika-analyysin perusteella "vaikein" 8-peli, jossa minimi siirtojen määrä on 31, ratkesi keskimäärin 47 millisekunnissa ja ratkaisuun vaadittiin 31 siirtoa eli algoritmi löysi parhaan mahdollisen ratkaisun. Kyseinen heuristiikka toimi myös niiden 15-pelien kohdalla, joiden alkutilanteen MD-arvo oli alle 30. Tätä suurempien MD-arvojen kohdalla algoritmi ei saanut laskettua tehokkaasti ratkaisua, ei edes useamman minuutin aikana. 

15-pelin ongelmaan löytyi lauantaina tunnin netin selailun ja pohdinnan jälkeen ratkaisu: pelitilanteet, joissa pelilaudan yläpuoli on mahdollisimman hyvässä järjestyksessä johtavat usein ratkaisuun. Kun MD-arvon laskennassa sovelsi yläpuolen painottamista alkoivat kaikki pelit, myös vaikeimmat: siirtoja vähintään 81, ratketa tehokkaasti. Valitettavasti ratkaisuun johtavien siirtojen määrä ei ollut kovinkaan optimaallinen. Siirtojen määrää pystyy optimoimaan heuristiikka funktiota muuttamalla. Tällä hetkellä parhaimmaksi kompromissiksi tehokkuuden ja optimisiirtomäärän suhteen on osoittautunut funktio, jossa perinteinen manhattan distance kerrotaan kahdella ja arvoa painotetaan siirtojen määrällä, value = 2 * MD + siirrot. Tämä antaa ratkaisuja joiden siirtomäärä on optimin ja n. 1,2 * optimin välillä. Se ettei algoritmi löydä ratkaisua heuristiikka funktiolla value = MD + siirrot, mutta löytää ratkaisun tehokkaasti funktiolla value = 2 * MD + siirrot, selittynee ratkaisuun vaadittavien siirtojen määrällä. 3x3 matriisin kohdalla optimiratkaisun siirtojen lukumäärä on korkeintaan 31, mutta 4x4 matriisin kohdalla vastaava luku on 81. Näin ollen 4x4 matriisi vaatii keskimäärin paljon enemmän siirtoja ratkaisuun kuin 3x3 matriisi. Koska siirtoja tarvitaan enemmän, siirtojen lukumäärä ei saisi vaikuttaa heuristiikka funktioon yhtä nopeasti kuin 3x3 matriisin kohdalla. 

Tällä hetkellä sekä pelilaudan yläpuolta painottava heuristiikka funktio että funktio value = 2 * MD + siirrot, löytävät ratkaisun kaikilla testaamillani alkutilanteilla maksimissaan 3 sekunnissa. Keskimäärin ratkaisu näyttäisi löytyvän n. 0,5 sekunnissa. Koodasin tänään metodin pelin erilaisten alkutilanteiden konstruointiin, mutten ole vielä ehtinyt käyttää sitä kuin vasta n.50 kertaa, joten kovin tarkkaa aika-analysointia en pysty vielä sanomaan. En myöskään pysty vielä sanomaan varmasti ratkaiseeko algoritmini kaikki 15-pelin mahdolliset alkutilanteet, mutta ainakin tällä hetkellä näyttäisi siltä. Algoritmi on ratkaissut tehokkaasti ainakin kaikki vaikeimmat alkutilanteet, siirtoja vähintään 81, joita olen testannut sekä kasan satunnaisesti konstruoituja alkutilanteita. Myöhemmin tarkoitukseni on koodata metodi tarkempaa aika-analysointia varten. Ajatuksena olisi, että metodi testaisi algoritmia vähintään useilla sadoilla erilaisilla alkutilanteilla ja rakentaisi niistä tarkempaa analytiikkaa algoritmin toiminnasta.

Tällä viikolla valtaosa ajasta on mennyt toimivan algoritmin laatimiseen. Kaiken kaikkiaan työtunteja on kertynyt n.15.  Olen laiminlyönyt jonkin verran siistin koodaamisen käytäntöjä. Tarkoituksenani on jatkossa siistiä koodia ylläpidettävämmäksi, luoda apumetodeja ja eriyttää laskentaa ja toimintoja paremmin omiin luokkiinsa . Tavoitteenani on löytää mahdollisimman hyvä tasapaino luettavuuden, ylläpidettävyyden ja tehokkuuden välillä. Tämän viikon osalta myös JUnit-testaus laahaa koodin määrään suhteutettuna pahasti perässä. Olen testannut metodeja manuaalisesti, mutten ole vielä laatinut juurikaan automaattisiatestejä, sillä en halunnut tehdä turhaa työtä 8-pelin algoritmin testeissä. 15-pelin ratkaisualgoritmi rakentuikin loppujen lopuksi paljon kivuttomammin kuin osasin odottaa. Priorisoin tietoisesti aikaa viimeisinä päivinä toimivaan algoritmiin, testauksen kustannuksella, jotta pääsin näkemään kuinka hyvin algoritmini toimii käytännössä. Seuraavan viikon tavoitteenani on siistiä koodia, koodata testaus ajantasalle ja aloittaa oman prioriteettijonon toteutus. Kun ydin osa-alueet ovat valmiit rupean keskittymään käyttöliittymään. Koska kyseessä ei ole pelattava peli, vaan ratkaisualgoritmi erilaisten pelien ratkaisemiseen, pidän tekstikäyttöliittymää todennäköisimpänä vaihtoehtona. Mitä mieltä olet, toisiko graafinen käyttöliittymä juurikaan lisäinformaatioita käyttäjälle? 
